<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="imgs/payrus_icon.png">
  <title>Payment Bridge</title>
  
  <link rel="stylesheet" href="payrus.css">
  <link rel="stylesheet" href="registration.css">

  <script src="frontend.js"></script>
</head>

<script>
  function validateEmail() {
    return validateInputField("RegistrationPanelEmailInput", "RegistrationPanelEmailStatus", function(value) {
      return String(value).toLowerCase().match(
        /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
      )
    })
  }

  function validatePassword() {
    return validateInputField("RegistrationPanelPasswordInput", "RegistrationPanelPasswordStatus", function(value) {
      return String(value).toLowerCase().match(
        /^([0-9]|[a-z]){10,}$/
      )
    })
  }

  function validatePasswordAndResetRetype() {
    document.getElementById("RegistrationPanelRetypePasswordInput").value = ""
    validatePassword()
  }

  function validateRetypePassword() {
    passwordElement = document.getElementById("RegistrationPanelPasswordInput")
    return validateInputField("RegistrationPanelRetypePasswordInput", "RegistrationPanelRetypePasswordStatus", function(value) {
      return value == passwordElement.value
    })
  }

  function validateDOB() {
    return validateInputField("RegistrationPanelDOBInput", "RegistrationPanelDOBStatus", function(value) {
      selectedDate = new Date(value)
      currentDate = Date.now()
      dateOffset = (24*60*60*1000) * 365 * 21; // 21 years

      return currentDate - selectedDate > dateOffset
    })

  }

  function performRegistration() {
    isValid = validateEmail() && validatePassword() && validateRetypePassword() && validateDOB()

    statusElement = document.getElementById("RegistrationPanelStatus")
    if (!isValid) {
      statusElement.innerHTML = "Убежитесь что все поля правильно заполнены"
    } else {
      acceptTermsElement = document.getElementById("RegistrationPanelAcceptTermsCheck")
      if (acceptTermsElement.checked) {
        statusElement.innerHTML = "Регистрируем эккаунт..."

        email = document.getElementById("RegistrationPanelEmailInput").value
        password = document.getElementById("RegistrationPanelPasswordInput").value
        dob = document.getElementById("RegistrationPanelDOBInput").value
        createAccount(email, password, dob, function(error) {
          if (error == null) {
            // Registration is successful - move forward to the dashboard
            window.location = "dashboard.html"
          } else {
            // Registration failed
            statusElement.innerHTML = "Что то пошло не так: " + error  
          }
        })
      } else {
        statusElement.innerHTML = "Подтвердите согласие на обрабоку персональных данных"
      }
    }
  }
</script>

<body">
  <div id="PayrusHeader">
    <div id="PayrusLeftSideHeaderMenu">
        <div class="payrus-header-menu-item" onclick="window.location='welcome.html'">Частным лицам</div>
        <div class="payrus-header-menu-item selected" onclick="window.location='registration.html'">Регистрация</div>
      </div>
      <div id="PayrusRightSideHeaderMenu">
        <div class="payrus-header-menu-item" onclick="window.location='howitworks.html'">Как это работает</div>
        <div class="payrus-header-menu-item" onclick="window.location='contactus.html'">Обратная связь</div>
      </div>
    </div>

  <div id="PayrusPageMainArea">
    <img id="PayrusLogo" src="imgs/payrus.png">
    <div id="RegistrationPanel">
      <div id="RegistrationDescription">
        Для того чтобы пользоваться нашими сервисами вам необходимо зарегистрироваться.
        <br>
        В процессе регистрации вам будет необходимо заподгтьб всего нескоьлко полей, но некторые из них
        относятся к категории общей песональной информации.
        <br>
        Ввиду этого факта вам будет необходимо подтвердить свое согласие на то, что наш сервис может сохранять, обрабатывать и передавать часть этих данный третим лицам.
        <br>
        Мы собираем лишь минимальную информацию, необходимую для только чтобы на Ваше имя можно было выпустить карточку.
        <br>
        Мы обрпащаем ваше вниминие, что данные введенные при решистрации будут передаваться и обраьатываться за пределы территории Российской Федерации.
      </div>
      <div id="RegistrationBox">
        <div id="RegistrationPanelEmailBox">
          <input id="RegistrationPanelEmailInput" type="text" placeholder="Email" oninput="validateEmail()">
          <div id="RegistrationPanelEmailStatus" class="input_status"></div>
          <div id="RegistrationPanelEmailHelp">На указанную электронную почту придет подтвержение</div>
        </div>
        <div id="RegistrationPanelPasswordBox">
          <input id="RegistrationPanelPasswordInput" type="password" placeholder="Пароль" oninput="validatePasswordAndResetRetype()">
          <div id="RegistrationPanelPasswordStatus" class="input_status"></div>
          <div id="RegistrationPanelPasswordHelp">Пароль должен содержать не менее 10 символов</div>
        </div>
        <div id="RegistrationPanelRetypePasswordBox">
          <input id="RegistrationPanelRetypePasswordInput" type="password" placeholder="Повторите пароль" oninput="validateRetypePassword()">
          <div id="RegistrationPanelRetypePasswordStatus" class="input_status"></div>
          <div id="RegistrationPanelRetypePasswordHelp">Повторно введенный пароль должен совпасть</div>
        </div>
        <div id="RegistrationPanelDOBBox">
          <input id="RegistrationPanelDOBInput" type="date" onchange="validateDOB()">
          <div id="RegistrationPanelDOBStatus" class="input_status"></div>
          <div id="RegistrationPanelDOBHelp">Вы должны быть старше 21 чтобы использовать сервис</div>
        </div>

        <input id="RegistrationPanelAcceptTermsCheck" type="checkbox">
        <label id="RegistrationPanelAcceptTermsCheckLabel" for="RegistrationPanelAcceptTermsCheck">Я согласен</label>
        <div id="RegistrationPanelTerms">
          Совершая регистрацию, я подтверждаю свое согласие на сбор, обработку и хранение, а также передачу моих пкрсональных данных, включая передачу и обработку моих данные за пределами Российской Федерации.
        </div>
        <button id="RegistrationButton" onclick="performRegistration()">Зарегистрироваться</button>
        <div id="RegistrationPanelStatus"></div>
      </div>
    </div>
  </div>

  <div id="PayrusFooter">
      PizTec Corporation, 2024.&nbsp;&nbsp;&nbsp;All Rights Reserved. 
  </div>
</body>
</html>
